
{% for result in results %}
{% set result_idx = loop.index0 %}
<h2>{{ result.original_card_info }}</h2>
<div class="card-gallery" id="card-gallery-{{ result_idx }}">
    {% if result.error %}
        <p class="error-message">{{ result.error }}</p>
    {% elif result.printings %}
        {% for card in result.printings %}
            {% set is_original = card.id == result.original_card_id %}
            {% set is_extra = loop.index > 5 %}
            <div class="card{% if is_original %} original{% endif %}{% if is_extra %} extra-card{% endif %}" 
                 data-card-id="{{ card.id }}"
                 data-card-name="{{ card.name }}"
                 data-set-code="{{ card.set_code }}"
                 data-collector-number="{{ card.collector_number }}"
                 data-image-uri="{{ card.image_uri_normal }}"
                 data-has-nonfoil="{{ 'true' if card.price_usd is not none else 'false' }}"
                 data-has-foil="{{ 'true' if card.price_foil is not none else 'false' }}">
                <div class="card-add-button-container">
                    {% if card.price_usd is not none and card.price_foil is not none %}
                        <button class="card-add-button" type="button" onclick="showFoilOptions(this)">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.7071 5.29289C17.0976 5.68342 17.0976 6.31658 16.7071 6.70711L8.70711 14.7071C8.31658 15.0976 7.68342 15.0976 7.29289 14.7071L3.29289 10.7071C2.90237 10.3166 2.90237 9.68342 3.29289 9.29289C3.68342 8.90237 4.31658 8.90237 4.70711 9.29289L8 12.5858L15.2929 5.29289C15.6834 4.90237 16.3166 4.90237 16.7071 5.29289Z" fill="currentColor"/>
                            </svg>
                        </button>
                        <div class="foil-options-menu" style="display: none;">
                            <button type="button" onclick="addToCart(this, 'nonfoil')">Non-Foil</button>
                            <button type="button" onclick="addToCart(this, 'foil')">Foil</button>
                        </div>
                    {% else %}
                        <button class="card-add-button" type="button" onclick="addToCart(this, '{{ 'nonfoil' if card.price_usd is not none else 'foil' }}')">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.7071 5.29289C17.0976 5.68342 17.0976 6.31658 16.7071 6.70711L8.70711 14.7071C8.31658 15.0976 7.68342 15.0976 7.29289 14.7071L3.29289 10.7071C2.90237 10.3166 2.90237 9.68342 3.29289 9.29289C3.68342 8.90237 4.31658 8.90237 4.70711 9.29289L8 12.5858L15.2929 5.29289C15.6834 4.90237 16.3166 4.90237 16.7071 5.29289Z" fill="currentColor"/>
                            </svg>
                        </button>
                    {% endif %}
                </div>
                <a href="{{ card.scryfall_uri }}" target="_blank" rel="noopener noreferrer">
                    <img 
                        {% if is_extra %}
                        data-src="{{ card.image_uri_normal }}"
                        {% else %}
                        src="{{ card.image_uri_normal }}"
                        {% endif %}
                        alt="{{ card.name }} ({{ card.set_code }})" 
                        loading="lazy">
                </a>
                <div class="card-details">
                    {{ card.set_code.upper() }}<br>
                    #{{ card.collector_number }}
                    {% if card.price_usd is not none and card.price_foil is not none %}
                        <br>Nonfoil, {{ card.foil_type or 'Foil' }}
                    {% elif card.price_usd is not none %}
                        <br>Nonfoil
                    {% elif card.price_foil is not none %}
                        <br>{{ card.foil_type or 'Foil' }}
                    {% endif %}
                </div>
                <div class="prices">
                    {% if is_original %}
                        {% if card.price_usd is not none %}
                            <span><strong>Non-Foil: ${{ "%.2f"|format(card.price_usd) }}</strong></span>
                        {% endif %}
                        {% if card.price_foil is not none %}
                            <span>{% if card.price_usd is none %}<strong>Foil: ${{ "%.2f"|format(card.price_foil) }}</strong>{% else %}Foil: ${{ "%.2f"|format(card.price_foil) }}{% endif %}</span>
                        {% endif %}
                    {% else %}
                        {% if card.price_usd is not none %}
                            <span>Non-Foil: ${{ "%.2f"|format(card.price_usd) }}</span>
                        {% endif %}
                        {% if card.price_foil is not none %}
                            <span>Foil: ${{ "%.2f"|format(card.price_foil) }}</span>
                        {% endif %}
                    {% endif %}
                    {% if card.price_usd is none and card.price_foil is none %}
                        <span>Price N/A</span>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
        {% if result.printings|length > 5 %}
            <div class="load-more-container">
                <button 
                    type="button" 
                    class="load-more-btn" 
                    data-target-id="card-gallery-{{ result_idx }}">
                    Load more printings
                </button>
            </div>
        {% endif %}
    {% else %}
         <p class="error-message">No printings found for this card.</p>
    {% endif %}
</div>
{% endfor %}
